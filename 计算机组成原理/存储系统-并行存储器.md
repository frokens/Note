## 3.5 并行存储器
转变CPU为中心的存储体系为内存为中心的存储体系：
	早期的计算机系统以 CPU 为中心。机器内部各个部件之间的信息传递都受 CPU 控制， I/O 设备与主存之间的信息交换也经过 CPU 的运算器。这种结构严重影响了 CPU 效能的发 挥，故以内存为中心的系统逐渐取代了以 CPU 为中心的结构。 这种以内存为中心的结构要求不仅 CPU 可以访问主存，而且其他部件(如 I/O 设备)也 可不经 CPU 而直接与主存交换信息。

CPU 和主存之间的数据交换速率，可以在不同==层次==采用不同的==技术==加速存 储器访问速度：
1. 芯片技术：
	提高单个芯片的访问速度。可以选用更高速的半导体器件，或者改善存储 芯片内部结构和对外接口方式。（[[存储系统-RAM&ROM#3.3.5 突发传输模式|突发传输技术]]，[[存储系统-RAM&ROM#3.3.6 同步 DRAM(SDRAM)|同步DRAM技术]]，[[存储系统-RAM&ROM#3.3.9 CDRAM|CDRAM技术]] ）
2. 结构技术：
	为了解决存储器与 CPU 速度不匹配问题，需要改进存储器与 CPU 之间的连接方式。（并行技术）
3. 系统结构技术：
	这是从整个存储系统的角度采用分层存储结构解决访问速度问题。
	例增加 [[存储系统-cache|cache]],，采用虚拟存储器等。

### 3.5.1 双端口存储器
#### 1. 双端口 存储器的逻辑结构
双端口由同一个存储器具有两组互相独立的读写控制电路组成，可以进行并行的独立操作。

#### 3. 处理冲突
当两个端口同时存取存储器同一存储单元，而且至少有一个端口为写操作时，便发生 读写冲突。为解决此问题，特设置了$\overline{BUSY}$ 标志。当冲突时，将被延迟端口设置$\overline{BUSY}$ 为低电平，暂时关闭此端口。当优先端口完成操作后，恢复高电平，允许延迟端口操作

如何判断哪个端口为优先或延迟呢？有如下两种判断方式：
1. $\overline{CE}$ 判断： 如果$\overline{CE}$  在 地址匹配有效后，通过判断$\overline{CE_L}$ 和$\overline{CE_R}$ 的有效时间先后，来决定端口
2. 地址有效判断：如果$\overline{CE}$ 在地址有效前，通过判断左、右地址间的时序来判断选择端口

通过设置 左右 $\overline{BUSY}$ 选择优先端口
### 3.5.2 多模块交叉存储器

#### 1. 存储器的模块化组织
由若干模块组成的主存储器有两种线性编制方式：
1. 顺序方式（代表了串行存取）
2. 交叉方式（代表了并行存取）

具体方式如图
![[Pasted image 20250403133227.png|500]]
内次地址位越低变换速度越块，越高位变换速度越慢（[[格雷码]]所有位变化一致）
将地址线变为控制线

顺序编码方式相邻字在同一模块，而交叉方式相邻字则在不同模块
	交错方式通过多模块多流水式并行存储，提升速率。

#### 2. 多模块交叉存储器的基本结构
并行存取如何提升存取效率：
	通过各个模块独立的控制电路，地址和数据寄存器，在CPU对连续的数据进行存取时，通过在上一个地址数据取出前，提前发出下一个地址的存储操作信号，而有效利用了等待上一个地址存储周期的时间，提高了主存的访问速度。

用总线传送周期 $\tau$ 远小于 存储周期 T 来提升传输速率
即成块传送按间隔$\tau$ 流水式传输，每经过 $\tau$ 时间延迟后启动下一个模块

为了实现流水线方式存取，应当满足
$$T \le m \tau$$
总线传送周期 $\tau$ ，  存储周期 T ， 模块数 m
为何要满足这个式子呢？应为要保证在 T 内 完成m个模块读取后，最早的那个模块完成了全部数据读取操作，可以进行下一次读取
所以m的最小值 $m_{min} = T/\tau$ 称为交叉存取度，要求交叉存储器的模块数必须要大于等于 $m_{min}$ 以保证启动模块后经 $m\tau$ 时间再次启动该模块后，它的上次存取操作已完成。

所以交叉方式存储器连续读取 m 个字所需时间为
$$t_1 = T + (m-1)\tau$$
而顺序范数存储器连续读取 m 个字所需时间为
$$t_2 = mT$$
![[Pasted image 20250404115326.png|600]]

#### 3. 二模块交叉存储器举例
3.26 表示二模块交叉存储器方框图。每个模块的容量为 1MB(256K×32 位)，由 8 片 256K×4 位的 DRAM 芯片组成(位扩展)。二模块的总容量为 2MB(512K×32 位)。数据 总线宽度为 32 位，地址总线宽度为 24 位。为简化，将 2 片 DRAM 芯片用一个 256K×8 位 的长条框表示。 

DRAM 有读周期、写周期和刷新周期。存储器读/写周期时，在行选通信号 RAS 有效下 输入行地址，在列选通信号CAS 有效下输入列地址，于是芯片中行列矩阵中的某一位组被 选中。如果是读周期，此位组内容被读出；如果是写周期，将总线上数据写入此位组。 刷新周期是在 RAS 有效下输入刷新地址，此地址指示的一行所有存储元全部被再生。 

==刷新周期比读/写周期有高的优先权==，当对同一行进行读/写与刷新操作时，存储控制器对读 /写请求予以暂存，延迟到此行刷新结束后再进行。 

由图 3.26 可看出：24 位的存储器物理地址指定的系统主存总容量可达 16MB，按==“存 储体-块-字”==进行寻址。其中高 3 位用于存储体选择(字扩展)，1 个存储体为 2MB，全系 统有 8 个 2MB 存储体。A20～A3 的 18 位地址用于模块中 256K 个存储字的选择。读/写周期 时，它们分为行、列地址两部分送至芯片的 9 位地址引脚。一个模块内所有芯片的 RAS 引 脚连接到一起，模块 0 由 RAS0驱动，模块 1 由 RAS1驱动。在读/写周期时，主存地址中 A2=0， RAS0有效；A2=1，RAS1有效。因此 A2 用于模块选择，连续的存储字(32 位)交错分布在两 个模块上，==偶字地址在模块 0，奇字地址在模块 1。==
![[Pasted image 20250404115907.png|600]]

由于采用 m=2 的交叉存取度的成块传送，两个 连续地址字的读取之间不必插入等待状态，这称为==零等待存取。==
![[Pasted image 20250404120219.png|600]]

