## 6.1 总线的概念和结构形态
### 6.1.1 总线的基本概念

分类：
1. 内部总线：CPU内部连接寄存器和各运算部件
2. 系统总线：同计算机系统的其他高速功能部件，如存储器、通道等互相连接的总线
3. I/O总线：中、低速 I/O 设备之间互相连接的总线

#### 1. 总线的特性
物理特性：
- 物理连接方式
- 总线根数
- 插座形状
- 引脚的排列方式
功能特性：
1. 地址总线：总线能够直接访问存储器的地址空间范围
2. 数据总线：宽度指明了访问一次存储器或外设时能够交 换数据的位数
3. 控制总线：包括 CPU 发出的各种控制命令(如存储器读/写、I/O 读/写)，请求 信号与仲裁信号，外设与 CPU 的时序同步信号，中断信号，DMA 控制信号
电气特性：
- 由CPU发出为OUT信号, 传入CPU为IN信号
- 高/低电平有效

#### 2. 总线性能衡量
总线带宽，代表最高传输速率：
$$
D_r= \frac{D}{T} = D \times f
$$
其中 $D$ 为并行传输的数据位数

### 6.1.2 总线的连接方式
各个外围设备速度各异，种类繁多，需要用适配器（接口）将其与CPU连接，用于统一管理传输速度匹配同步和信号控制。
#### 1. 单总线结构
![[Pasted image 20250515105843.png|400]]

所有的I/O接口，主存，CPU都连接在同一根系统总线上
所以在单总线结构中，要求连接到总线上的逻辑部件必须高速运行，以便快速切换控制权。
CPU通过地址字段对应的设备地址，选择与主存还是I/O间数据传输。
而外设也可以通过获得总线控制权，发送地址信号，进行设备间和与主存的信息交换

#### 2. 多总线结构
单总线系统中，由于所有的高速设备和低速设备都挂在同一总线上，且总线只能分时工作，即某一时间只能允许在一对儿设备之间传送数据，这就使信息传送的效率和吞吐量 受到极大限制。
![[Pasted image 20250515110711.png|500]]
CPU、存储器控制器和两个 PCI-E 桥通过接口与高速的前端总线(FSB)相连。而其余设备连接在总线桥上，总线桥是一种具有缓冲、转换、控制功能的逻辑电路。
多总线结构确保高速、中速、低速设备连接到不同的总线上同时工作，以提高总线的效率和吞吐量（减少总线竞争，并行处理），而且处理器结构的变化不影响高速总线（通过总线桥可以翻译不同协议，便于模块化）。

### 6.1.3 总线的内部结构
早期总线的内部结构如图 6.3 所示，它实际上是处理器芯片引脚的延伸。
![[Pasted image 20250515113421.png|450]]
按功能划分：
1. 地址线：双向
2. 数据线：单向（CPU ->设备）
3. 控制线：一般而言对每一根线是单向的(CPU 发向接口，或 接口发向 CPU)，用来指明数据传送的方向(存储器读、存储器写、I/O 读、I/O 写)、中断控 制(请求、识别)和定时控制等。

早期总系结构结构不足：
1. CPU是总线上的唯一主控者，浪费性能和无法满足多CPU环境
2. 总线信号是 CPU 引脚信号的延伸，无法模块化拓展，通用性差

#### 当代总线的内部结构：
它是一些标准总线，追求与结构、CPU、技术 无关的开发标准，并满足包括多个 CPU 在内的主控者环境需求。
![[Pasted image 20250515113955.png|450]]
在当代总线结构中，CPU 和它私有的 cache 一起作为一个模块与总线相连。系统中允 许有多个这样的处理器模块。

- **数据传送总线**： 由地址线、数据线、控制线组成。其结构与图 6.3 中的简单总线相似， 但一般信号条数较多，如 32 条地址线，32 或 64 条数据线。为了减少引脚数量，64 位数据 的低 32 位数据线常常和地址线采用多路复用方式。 
- **仲裁总线**： 包括总线请求线和总线授权线。
- **中断和同步总线**： 用于处理带优先级的中断操作，包括中断请求线和中断认可线。
- **公用线**： 包括时钟信号线、电源线、地线、系统复位线以及加电或断电的时序信号线等。

CPU 总线（CPU,cache,主存），PCI 总线（高速设备），ISA总线（低速设备）
CPU 总线、PCI 总线、ISA 总线通过两个“桥”芯片连成整体。桥芯片在此 起到了信号速度缓冲、电平转换和控制协议的转换作用。
**CPU 总线-PCI 总线**的 桥称为 **北桥**，将 **PCI 总线-ISA 总线**的桥称为 **南桥**。
通过桥将两类不同的总线“粘合”在一 起的技术特别适合于系统的升级换代。这样，每当 CPU 芯片升级时只需改变 CPU 总线和 北桥芯片，全部原有的外围设备可自动继续工作。

## 6.2 总线接口
### 6.2.1 信息传送方式
#### 1. 串行传递
有一条传输线，且采用脉冲传送，位时间是由同步脉冲来体现的。
#### 2. 并行传递
每个数据位都需要单独一条传输线。

在串行传送时，被传送的数据需要在发送部件进行并-串变换，这称为拆卸；而在接收 部件又需要进行串-并变换，这称为装配。

### 6.2.2 总线接口的基本概念
I/O 功能模块通常简称为 I/O 接口，也叫适配器。
动态连接的两个部 件之间起着“转换器”的作用，以便实现彼此之间的信息传送。
![[Pasted image 20250515135949.png|300]]

一个标准 I/O 接口可能连接一个设备，也可能连接多个设备。
![[Pasted image 20250515140251.png|350]]
控制/缓冲/状态/转换(串并转换)/整理(修改字计数器)/程序中断
系统总线接口：CPU和I/O接口模块传输为并行方式
外部设备接口：并行方式或串行方式

## 6.3 总线仲裁
CPU 模块在不同时间即可以用作主方，也可用作从方；而存储器模块只能用作从方。
主方(主设备)可以启动一个总线 周期，而从方(从设备)只能响应主方的请求。

对多个主设备提出的占用总线请求，一般采用优先级或公平策略进行仲裁。
例如，在 多处理器系统中对各 CPU 模块的总线请求采用公平的原则来处理，而对 I/O 模块的总线请 求采用优先级策略。主方持续控制总线的时间称为 **总线占用期**

仲裁方式：
- 集中式仲裁
- 分布式仲裁。

![[Pasted image 20250515142056.png|450]]

a. 菊花链查询方式：查询链中离总线仲裁器最近的设备具有最高优先级，离总线仲裁器越远，优 先级越低。因此，链式查询是通过接口的优先级排队电路来实现的。

b. 计数器定时查询方式：某设备要使用总线时，会在BR发出总线请求。总线仲裁器接到请求信号以后，在 BS 线为“0” 的情况下让计数器开始计数，通过地址线送出计数值给各个设备，当计数值与请求总线的设备地址相一致时，该设备获得总线使用权，BS置1.
	计数器的初值可以自由设置值，增加灵活性

c. 独立请求方式：每一个共享总线的设备均有一对总线请求线 $BR_i$ 和总线授权线 $BG_i$。总线仲裁器中有一个排队电路，给设备以授权信号 $BG_i$。

### 6.3.2 分布式仲裁
分布式仲裁不需要集中的总线仲裁器，每个潜在的主方功能模块都有自己的仲裁号和 仲裁器。当它们有总线请求时，把它们唯一的仲裁号发送到共享的仲裁总线上，每个仲裁 器将仲裁总线上得到的号与自己的号进行比较。如果仲裁总线上的号大，则它的总线请求 不予响应，并撤销它的仲裁号。最后，获胜者的仲裁号保留在仲裁总线上。显然，分布式 仲裁是以优先级仲裁策略为基础的。
![[Pasted image 20250515143332.png|400]]

	 