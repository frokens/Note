7### 3.3.1 停等协议(Stop and Wait)
发送方每发送一帧才后等待到收到的信号，会发送后一帧

![[Pasted image 20250410200444.png|500]]

有四种情况：
1.  正常情况
2. 数据帧丢失
	- 帧超时重发
3. 数据帧出错
	- 检测出错，接受方发送NAK，发送方重新发送
4. 应答帧丢失
	- 下一帧号不同，重新发送AK


#### 停等协议的信道利用率

假设信道容量为B(bps)，帧长为L(bits)，所以一帧的实际发送时间为L/B，如果信号的传播时间为２R(s)，则其信道利用率为：

$$
Ｕ＝\frac{L/B}{L/B+2R}=\frac{L}{2RB+L}
$$

![[Pasted image 20250410202107.png|300]]

当考虑在传输过程中出现错误时的情况：
设帧内有效数据长度为D(bits)，帧头和帧尾长度为H(bits)，等待ACK超时间隔为T(s)，数据帧和ACK帧出错以及丢失的概率分别为$P_2$和$P_2$。

![[Pasted image 20250410202428.png|300]]

正常接收的概率 P 为：
$$
P=1-(1-P_1)(1-P_2)
$$
最后化简的有效利用率为：
$$
U = \frac{L}{H+2RB+L}(1-p_1)(1-P_2)\frac{L}{D}
$$


若进一步假设比特误码率是E，则
$$
1-P_1  = (1-E)^L, ~1-P_2 = (1-E)^H
$$

带入得：
![[Pasted image 20250410203439.png|200]]

令UD’=0，可求到最佳帧长度$D_{opt}$：

![[Pasted image 20250410203513.png|500]]

由于通常E->0，所以可得 ：

![[Pasted image 20250410203535.png|200]]

#### 停等协议的捎带确认
往往数据传输是双向的，一个端口既是发送方又是接受方，通过 在发送帧中添加上一个接受帧的确认信号，提升信道传输效率（原来ACK和数据要连续发送两次）

可能会发生错位，当双方同时发送时，上一帧的确认信号，在这一帧发送前才收到


---
### 3.3.2 顺序接收管道协议
使用管道协议：
- 可以提高信道的有效利用率，就要允许发送方不等确认帧返回就再连续发送若干帧 。
- 由于允许连续发出多个未被确认的帧，帧号就不能仅采用一位（只有0和1两种帧号），而要采用多位帧号才能区分 。
- 凡是被发送出去尚未被确认的帧都可能出错或丢失而要求重发，因而都要保留下来。这就要求发送方有较大的发送缓冲区保留准备重发的帧。

#### 1. 回退 n 法
帧号字段的位数m要满足：
$$
m \ge \log_2{\frac{L+2RB + H}{L}}
$$
![[Pasted image 20250410210640.png|600]]

即某一帧出错后，要回到出错的帧重新再发送，即使后面的帧已经发送了

缺点：
允许已发送未被确认的帧越多，可能要退回来重发的帧也越多。

改进：发送窗口（控制 在一次确认周期内发送帧的数量）
	为了控制发送方的发送速度以及受发送缓冲区大小的制约等因素都要求对发送方已发出但尚未经确认的帧的数目加以限制，这个数目就是“发送窗口”。
	落在这个窗口内的帧号就是等待接收返回的Ack信息的帧号。由于帧号只有有限的位数，到一定时间后就又反复循环了。

#### 2. 选择重传(selective repeat)协议
针对回退n法的缺点作出改进，若某一帧出错后，接收方对后面送来的正确的帧先收下，放在一个缓冲区，同时要求发送方重传出错的帧，一旦收到后把原先暂存在缓冲区的其余帧一起按正确顺序送往主机。

![[Pasted image 20250410211436.png|600]]

但在出错后的帧不发送 信息，在后面的帧的编号到了，表示前面的帧全部收到


### 3.3.4 流量控制的滑动窗口机制
发送窗口WT：
    指发送端已发送但未被确认的数据帧的数目

接收窗口WR：
    指接收端允许接收的帧的数目

回退n法，接受窗口为1

可以用滑动窗口的观点来统一看待停等、回退n和选择重传这三种协议，其差别仅在其窗口的大小

| 协议   | 发送窗口              | 接收窗口 |
| ---- | ----------------- | ---- |
| 停等   | 1                 | 1    |
| 回退n  | 大于1，小于等于2m-1      | 1    |
| 选择重传 | 大于1，小于等于$2^{m-1}$ | 大于1  |
保留一个窗口关闭，防止编号混淆，例如 （全部打开，不知道是0还是8）

为何回退n的发送窗口要小于等于2m-1 ？
    假设发送过程发送帧0到7；帧7的捎带确认回到发送过程；发送过程发送另外8帧，序号再次为0到7；现在帧7的另一个捎带确认到达。那么，是第二次发送的8帧都成功了还是全部丢失了？
    
![[Pasted image 20250410213946.png|500]]

为何选择重传的发送窗口要小于等于$2^{m-1}$ ？

![[Pasted image 20250414130612.png|350]]


接受窗口小于等于发送窗口