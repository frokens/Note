### 5.1.3 最佳路由
> [!定义]
> 给定一个代表该网络的图，找到从源到目的地的最小花费路径要求能够找到一条由一系列链路组成的路径 

#### 1. DIjkstra算法
略

### 5.1.4 静态路由
> [!定义]
> 按照固定规则、使用初始静态信息进行路由选择，不按网络当前的通信量和拓扑结构进行路由选择，也被称为非自适应路由
> 
> 动态路由——即自适应路由选择，节点的路由选择要根据网络的当前状态信息来决定，以适应网络负载和拓扑结构的变化。

分类：
1. 扩散法
2. 固定路由选择
3. 随机路由选择
4. 基于流量的路由选择

#### 1. 扩散法
当节点收到一个分组后，把该分组除源线路外全部其他输出线路上发出

如果无限制的分组转发，网络会不断循环，导致奔溃，解决方法如下：
1. 分组头加一个计数器，每次转发计数减一，若为0，则扔掉该分组
2. 另一种方法是记录下分组扩散的路径，防止它第二次再扩散到已扩散过的路径中
3. 选择扩散法：节点选择那些很可能向目的节点的方向去的节点。这里考虑的方向可以是地理上的方向，也可以是网络拓扑中的大致方向。

扩散法可被用来分发信息、判断可达性、找到最短路径。

---
#### 2. 固定路由方法
使用路由表，每一个节点的路由表每一项记录着到目标节点的下一项节点或链路


![[Pasted image 20250427134032.png|300]]

![[Pasted image 20250427134056.png|300]]

优化方法：
	在下一最佳节点外，而外提供几个替换节点，这些节点的使用符合一定的概率，以防最佳节点断开。

#### 3.随机路由选择
当一个分组到达节点后，随意选择一条输出线路进行转发的方法。
缺点
	该算法实际选择的不一定是最佳路由,因此增加了不必要的负载,且分组传输延迟也不可预料，所以这种方法很少使用。

#### 4. 基于流量的路由选择
是一种既考虑拓扑结构又兼顾负载的静态路由算法。

> [!基本思想]
> 对某一给定的线路，如果已知载荷量与平均流量，那么就可以根据排队论的理论计算出该线路上的平均分组延迟。


### 5.1.5 动态路由
路由器之间交换路由信息，根据它所了解到的网络信息计算最佳路由，以设法适应网络流量、拓扑的变化。现代计算机网络更多地使用动态路由方式。

根据网络信息的来源，有三类动态路由：
- 孤立路由选择
- 集中路由选择
- 分布路由选择

对应z着网络状态信息的三种来源：
- 本地
- 所有节点
- 相邻节点

#### 1. 孤立路由算法：
最短等待法：
	选择具有最短队列的链路转发
逆向学习法：
	根据逆向的路由节点数，选择节点数最少的链路转发

#### 2. 集中式路由算法
固定路由选择一样，每个节点都保存了一张当前的路由表。
由路由控制中心RCC(Routing Control Center)负责全网所有节点网络信息的收集、路由计算及路由选择的实现。

#### 3.分布路由算法
分布路由选择根据来自于相邻节点的信息，通过一个最短花费路由算法计算出到每个目的地的路由，分布路由选择算法得到了广泛的使用。

##### a.距离向量路由选择

把自己的路由表发给邻居节点

坏消息的传播缓慢，且有无穷计数
解决方法，水平分隔（split horizon）算法
    基本思想是对路由更新消息时进行限制，当通过一个特定的网络接口X发送距离向量时，一定不要包括通过那个网络接口学习到的路由信息。

##### b.链路状态路由选择

链路状态分组，只包含邻居链表（无需全部节点，随着网络规模的扩大，表不会过大，交换信息少）
和发送方标识，序号和年龄（相当于计数器，为0失效）。

![[Pasted image 20250427142857.png|500]]

链路状态分组容易创建，难的是何时创建链路状态分组。

发布链路状态分组：
使用扩散法来发布链路状态分组。

## 5.2 路由协议
### 自治系统(AS)：
一个互联网，由若干个自治系统组成，AS内部可以选择任何路由协议，来进行AS内部的路由。

每个AS都被分配了一个AS编号，该AS编号由IANA进行分配，它唯一地标识了对应的AS。

为了使AS中的网络能够被互连网中别的AS访问到，它必须把AS内网络路由器的==可达性信息==传递给其他AS，实现AS间的路由。

内部邻居：两个属于同一AS并交换路由信息的路由器。之间使用内部网关协议IGP。
外部邻居：两个属于不同AS并且交换路由信息的路由器。之间使用外部网关协议EGP。

路由和路由协议就分为两个层次:
	各个AS内部使用IGP路由协议，但AS之间使用的是EGP路由协议。
如果一个分组要从一个AS的一台主机传给另一个AS的一台主机，在第一个系统的路由器只需要决定目的主机所在的AS ，并找出一条到目的AS的路由。
一旦分组进入目的AS，在那个系统内的路由器互相协作并最终把该分组递交过去。

#### RIP协议：
内部网关协议IGP最常用 RIP协议：
	RIP是一种分布式的==基于距离向量==的路由协议。
	RIP 协议要求网络中的每一个路由器都要维护从它自己到其他每一个目的网络的距离记录。

有两种工作模式：
- 被动模式：不传递自己的表，只听其他路由器广播的信息
- 主动模式：定期把路由信息传递给其它RIP路由器，并根据收到的RIP消息来更新自己的路由表。

路由表项：
	–目的地IP地址
	–到目的地路径的距离度量
	–到目的地路径的下一个路由器IP地址（如果目的地是直接连接的，不需要这个字段）
	–路由改变标志（指示这条路由信息是否最近被改变过）
	–和这条路由有关的一些计时器

RIP采用的距离度量是一种非常简单的测量到目的地的距离的方式：
	站点计数度量

RIP在具体实现时常常允许管理人员对一些慢速的网络指定一个更大的距离度量值(>1)。


RIP路由失效（计时器）：
	在路由表中对每一条路由都有一个计时器，当收到新的有关消息时，计时器重置。
	如果计时器超时（超过180秒，即连续6次没有收到路由消息），这条路由就被宣告为失效，即目的地不可达。
	失效路由并不马上从路由表中删去，因为这条失效的路由还应该向邻居路由器报告，经过一段超时（garbage-collection timer）后，该路由最终被从路由器中去掉。

基于路由向量的路由协议，在坏消息时会有无穷计数的问题
RIP通过距离在16 hops以上的路由作为不可达解决：
	这样如果超过 16hops 还无法找到，那就表面发现了无穷计数问题，目标路由不可达：

水平分割只能解决两个节点间的路由回路。
无法完全解决三个及以上的多个节点的路由回路问题

带反向抑制的水平分割：
	像往常一样发送给邻居节点发送路由信息，只是那些从该邻居节点了解到的路由信息的距离被置为无穷大。


触发更新：
当路由器了解到到某个目的地的路由有变化时，马上发送更新消息，从而加快收敛过程。

抑制机制：
在发生触发更新时开始一个抑制计时器，忽略来自于邻居路由器的有关到该目的地的消息。以防触发更新产生的网络风暴。

RIP的局限：
- 不能用在网络直径大于15的网络中。
- RIP使用的距离度量非常简单，不能根据网络延迟或负载来选择路由。
- 尽管RIP采用了很多措施（如带反向抑制的水平分割和触发更新等）来解决无穷计数问题，但是这种可能性仍然存在，因此RIP一般用在网络规模不是很大的场合。

但RIP实现简单。目前的版本是RIPv2，支持子网、IP组播、路由器认证机制。

#### RIP2协议的报文格式：

![[Pasted image 20250428133412.png|500]]

#### OSPF(开发最短路径优先先验)
是分布式的链路状态协议


## 5.3 Internet 网络层
Internet网络层的主体是IP，IP分组是真正应用数据的承载体。

### 5.3.1 IP地址
