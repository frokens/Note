## 概述：
利用协作LLM agent根据自然语言指示生成具有相对较高LOD(level of detail)的BIM模型
将建筑文本描述，转为BIM代码，调用建模api工具生成BIM

以往生成BIM研究侧重于通过各种机器学习模型学习3D模型特征，生成BIM：
	GANs to generate conceptual 3D buildings
	VAE reconstruction interpolated positions within learned distribution

## 运行流程
![[Pasted image 20250326173828.png]]
核心思想是使用一系列自定义高级工具功能封装软件的基础建模API。通过使用及时的工程技术指导LLM在生成的代码中调用这些功能，我们可以通过简洁有效的文本表示构建本机BIM模型。

协作llm agent包括:
- [[Text2BIM#2. 产品所有者(product owener) & 建筑师(Architect)|产品所有者(product owener)]]: 将用户输入的简单模型说明增强，生成详细的要求文档
-  [[Text2BIM#2. 产品所有者(product owener) & 建筑师(Architect)|建筑师(Architect)]]：根据建筑知识制定文本建筑计划
- 程序员(programmer)：分析要求并写入建筑代码
- 审阅者(reviewer)：提供代码优化建议，以解决模型中确定问题

## 各个组件
### 1. toolsets
使用高级操作的api接口（Vectorworkers SDK库），而不是低级操作api。
- 高级操作有具体的功能逻辑，便于LLM理解
- 高级操作由低级操作组成，简化流程，便于LLM理解
- 高级操作本身包含了建筑的设计规范和工程逻辑，无需LLM额外理解
这些高级操作api写在vs.py文件里 以函数的形式（输入输出，函数描述）
例：
	给一个正在创建中的 3D 多边形添加顶点。
``` python
def Add3DPt(

        p  # POINT3D - Location of 3D vertex.

        ):

    '''

        Python: vs.Add3DPt(p)

        VectorScript: PROCEDURE Add3DPt(pX, pY, pZ:REAL);

        Category: Objects - 3D

        Procedure Add3DPt adds a vertex into a newly created 3D polygon.

        Calls to Add3DPt should be made between calls to BeginPoly3D, which initiates polygon creation, and EndPoly3D, which terminates polygon creation. A minimum of two vertices must be created to define a valid 3D polygon object, and calculations may be performed within the BeginPoly3D-EndPoly3D structure, providing additional options for vertex generation.

    '''

    pass
```


### 2. 描述增强

用户输入的对建筑描述的文字通常过于宽泛和不规范化，通过产品所有者和建筑师将简单文字描述转化为符合建筑设计和结构规范的计划，用于后续的编程任务

#### 产品所有者prompt功能:
 - 指导 AI 程序员在 Vectorworks 中编写 Python 脚本来完成用户指定的任务
	 - 给出关于坐标和尺寸的详细提示 
 - 理解 API 文档的大师：擅长根据可用的功能将用户的原始指令分解为子任务和子逻辑，并能够以更严格和详细的方式表达用户的描述。
- 需要建筑咨询时，生成json文件调用架构师：

#### 架构师prompt功能：
- 角色：经验丰富的建筑师
	- 扩展和补充用户的原始描述
	- 以结构化文本格式表达您的设计
- 建筑规则，例：
	- 地基布局，墙体布局，结构完整性...
- 生成格式：
	- **地基：**
	- 矩形基础板：30000mm x 15000mm
	
	**底层平面图：**
	
	1. **周边墙：**
	- 墙 A：(0,0) 至 (30000,0)
	- 墙 B：(30000,0) 至 (30000,15000)
	- 墙 C：(30000,15000) 至(0,15000)
	- 墙 D：(0,15000) 至 (0,0)
	
	1. **功能区域**
	边界格式为 (x_min,y_min),（x_max,y_max):
	- 房间 1：(0,0), (10000,6000)
	- 房间 2：(10000,0), (20000,6000)
	- 房间 3：(20000,0), (30000,6000)
	- 房间 4：(0,9000), (10000,15000)
	- 房间 5：(10000,9000), (20000,15000)
	- 房间 6：(20000,9000), (30000,15000)
	- 中央走廊：(0,6000) (30000,9000)
	
	1. **内部走廊墙壁：**
	- 墙壁 E：(0,6000) 至 (30000,6000)
	- 墙壁 F：(0,9000) 至 (30000,9000)
	
	1. **房间分隔墙：**
	- 墙壁 G：(10000,0) 至 (10000,6000)
	- 墙壁 H：(20000,0) 至 (20000,6000)
	- 墙壁 I：(10000,9000) 至 (10000,15000)
	- 墙壁 J：(20000,9000) 至 (20000,15000)

### 3. 模型生成代码编写
将结构化的增强模型描述交给programmer, 程序员agent编写代码，在代码解释器抛出异常后，将异常独立的重新输入程序员agent, 直至没有异常。这些异常不会保存到长期记忆中

### 4. 模型评估和迭代改进
基于规则模型评估：
1. 几何冲突：门窗重叠，墙体交叉
2. 语义属性定义：组件信息完整性正确性，GUID唯一性等
3. 建筑常识检查：承重结构合理性

将检查的输出导初到BCF文本文件，交给审阅者(reviewer)提出改进建议，最后审阅者agent将建议反馈给程序员agnet，不断迭代直至BCF无错误

## 问题和思考

#####  1. 当前api工具集只能构建常规的非弯曲的模型，需要更加复杂的工具集和组织管理工具的方法（RAG）

在Text2BIM方法中，由于主要目标在于从简单、开放的文字描述中快速生成一个“行得通”的原型模型，而不是生产最终施工级别的详尽模型，因此，即使模型中存在一些高维（3D）信息的缺失，也不会对整体原型设计产生致命影响。具体理由如下：

- **设计原型的定位**  
    Text2BIM主要用于早期概念设计阶段，其重点在于捕捉设计意图和空间大致布局，而不是追求极致的三维细节。设计原型本身就是一个可以不断迭代、逐步完善的初始版本，即使部分高维信息（例如屋顶）未能完全捕捉，也可以在后续人工或自动化审查中予以补充和改进。
    
- **基于规则的粗略检测足以确保基本结构合理**  
    Text2BIM在生成过程中通过调用高层API和基于规则的检测，能够捕捉到一些明显的结构问题（例如墙体冲突或基本尺寸错误），从而保证生成的原型在大方向上是合理的。由于生成的模型仅用于概念验证，细节问题可以后续由设计师进行手动调整。
    
- **人机协作的迭代改进机制**  
    Text2BIM框架中设计了审阅者(reviewer)角色，通过规则检查和人工反馈不断迭代优化模型，降低了初始文本描述中遗漏高维信息的影响。原型模型生成后，人类设计师可以利用视觉判断快速发现和修正例如缺少屋顶等问题。
    

而对于CAD2BIM来说，要求模型必须严格遵循二维CAD图纸的信息——包括精确的尺寸、边界和布局关系。由此产生的原因主要有：

- **严格一致性要求**  
    CAD2BIM的目标在于将已有的二维CAD图纸准确转换为三维BIM模型。这要求在转换过程中必须保持二维图纸中的所有几何信息和结构关系，否则会导致模型与原始设计不符，从而直接影响后续的施工和工程验证。
    
- **二维与三维信息的对比与校验**  
    由于二维图纸通常包含精确的标注和尺寸信息，转换成三维模型时不仅需要正确重现这些信息，还要通过对比检查确保没有遗漏任何关键构件（例如屋顶、墙体或门窗等）。这需要LLM agent具备从二维文本描述中理解并比对三维信息的能力，这种跨维度理解能力远比单纯从文本规则碰撞中捕捉漏洞要复杂得多。
    
- **最终应用场景的高精度需求**  
    BIM模型通常用于施工、后期维护和运营管理，任何小的几何或语义误差都可能带来施工错误或成本浪费。因此，CAD2BIM在转换过程中必须确保模型与二维图纸严格一致，这对LLM agent的空间理解和对比能力提出了更高要求，需要借助合适的媒介实现高维信息的准确传递和验证。
    

综上所述，Text2BIM因定位于初步原型设计，其对高维信息捕捉的不足可以通过后续迭代改进弥补；而CAD2BIM则因涉及最终施工文档的严格要求，必须确保二维与三维数据在结构、尺寸和语义上的一致性，这就要求转换过程中必须具备更为精确和全面的信息理解与比对机制。